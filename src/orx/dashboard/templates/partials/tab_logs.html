<div class="tab-content">
    <div class="logs-container">
        <div class="log-controls">
            {% if logs %}
            <select id="log-selector" onchange="loadLog(this.value)">
                {% for log_name in logs %}
                <option value="{{ log_name }}">ðŸ“„ {{ log_name }}</option>
                {% endfor %}
            </select>
            {% else %}
            <div class="text-muted">No logs available</div>
            {% endif %}
            
            <label style="margin-left: auto;">
                <input type="checkbox" id="auto-scroll" checked>
                Auto-scroll
            </label>
            <button class="btn btn-secondary btn-sm" onclick="scrollToBottom()">
                â†“ Bottom
            </button>
        </div>
        
        <div class="log-output" id="log-output"
             {% if logs %}
             hx-get="/partials/log-tail/{{ run.run_id }}?name={{ logs[0] }}&cursor=0&lines=200"
             {% endif %}
             hx-trigger="load"
             hx-swap="innerHTML">
            <div class="loading">{% if logs %}Loading logs...{% else %}No logs available{% endif %}</div>
        </div>
    </div>
</div>

<script>
function scrollToBottom() {
    const output = document.getElementById('log-output');
    output.scrollTop = output.scrollHeight;
}

function loadLog(logName) {
    const runId = '{{ run.run_id }}';
    htmx.ajax('GET', `/partials/log-tail/${runId}?name=${encodeURIComponent(logName)}&cursor=0&lines=200`, {
        target: '#log-output',
        swap: 'innerHTML'
    });
}

// Auto-scroll on htmx swap
document.body.addEventListener('htmx:afterSwap', function(evt) {
    if (evt.detail.target.id === 'log-output' && document.getElementById('auto-scroll').checked) {
        scrollToBottom();
    }
});
</script>
