{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="page-header">
    <a href="/" class="back-link">‚Üê All Runs</a>
</div>

<!-- Run Header (polled while running) -->
<div id="run-header"
     hx-get="/partials/run-header/{{ run.run_id }}"
     {% if run.is_active %}
     hx-trigger="load, every {{ poll_interval }}s"
     {% else %}
     hx-trigger="load"
     {% endif %}
     hx-swap="outerHTML">
    <div class="loading">Loading...</div>
</div>

<!-- Tabs -->
<div class="tabs">
    <button class="tab active" 
            data-tab="overview"
            hx-get="/partials/run-tab/{{ run.run_id }}?tab=overview"
            hx-target="#tab-content"
            hx-swap="innerHTML"
            onclick="setActiveTab(this)">
        Overview
    </button>
    <button class="tab"
            data-tab="artifacts"
            hx-get="/partials/run-tab/{{ run.run_id }}?tab=artifacts"
            hx-target="#tab-content"
            hx-swap="innerHTML"
            onclick="setActiveTab(this)">
        Artifacts
    </button>
    <button class="tab"
            data-tab="diff"
            hx-get="/partials/run-tab/{{ run.run_id }}?tab=diff"
            hx-target="#tab-content"
            hx-swap="innerHTML"
            onclick="setActiveTab(this)">
        Diff
    </button>
    <button class="tab"
            data-tab="logs"
            hx-get="/partials/run-tab/{{ run.run_id }}?tab=logs"
            hx-target="#tab-content"
            hx-swap="innerHTML"
            onclick="setActiveTab(this)">
        Logs
    </button>
    {% if run.has_metrics %}
    <button class="tab"
            data-tab="metrics"
            hx-get="/partials/run-tab/{{ run.run_id }}?tab=metrics"
            hx-target="#tab-content"
            hx-swap="innerHTML"
            onclick="setActiveTab(this)">
        Metrics
    </button>
    {% endif %}
</div>

<!-- Tab Content -->
<div id="tab-content"
     hx-get="/partials/run-tab/{{ run.run_id }}?tab=overview"
     hx-trigger="load"
     hx-swap="innerHTML">
    <div class="loading">Loading...</div>
</div>
{% endblock %}

{% block scripts %}
<script>
function setActiveTab(btn) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
}
</script>
{% endblock %}
